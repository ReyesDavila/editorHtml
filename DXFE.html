<!DOCTYPE html>
<html lang="es">

<head>
    <title>DXFE</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes">
    <link rel="shortcut icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAvElEQVRYR+2WUQ6AMAhDx/0PjdnHEpzCYMFijP66rS91tFIrfqhYv70LgJl5OEJEELiTiAegr8mECwEMwBIAjzs7F9rlgBTfEZn3SAeXANniHSYE0DdkQ4QBZoiSSyghygAGRClAxhTIM5ZTkC14GcmnBVbnQwrHgoABaFH+LQCrqiEOWHUNBZgLx4pyNQdW4+N5LxPT5UB260knSgDCDnhstdZYv20uB7IA7toSBqBVNQRg5/PAoliD+wEOXE+oIYUeBr0AAAAASUVORK5CYIIA">
</head>

<body>
    <style>
        body {
            background-color: rgb(31, 31, 31);
            color: rgb(200, 225, 250);
            height: calc(100vh - 2px);
            margin: 0px;
            padding: 0px;
            position: relative;
            font-family: 'Courier New', Courier, monospace;
            overflow: hidden;
        }

        #contenedor_textarea {
            /*border: 1px solid green;*/
            width: calc(100% - 2px);
            height: calc(100% - 2px);
            margin: 0px;
            overflow: auto;
            padding: 0px;
            position: relative;
        }

        .textarea{
            /*border: 1px solid blue;*/
            border-width: 0px;
            border-style: none;
            background: rgb(31, 31, 31);
            color: rgb(200, 225, 250);
            resize: none;
            padding: 0px;
            padding-top: 32px;
            padding-left: 54px;
            margin: 0px;
            overflow: hidden;
            white-space: nowrap;
	    white-space: pre-wrap;
            min-width: calc(100vw - 2px - 54px);
            min-height: calc(100vh - 32px - 7px);
            font-size: 16px;
            font-family: 'Courier New', Courier, monospace;
            caret-color: white;
        }

        #capa_textarea{
            background-color: transparent;
            pointer-events: none;
            position: absolute;
            top: 0px;
            left: 0px;
            z-index: 1;
            white-space: pre;
        }

        textarea:focus {
            outline: none;
        }

        #enumerador_textarea {
	    visibility: hidden;
            padding: 5px;
            padding-top: 32px;
            background: rgba(27, 26, 26, 0.9);
            width: calc(54px - 10px);
            height: fit-content;
            font-size: 16px;
            font-family: 'Courier New', Courier, monospace;
            font-style: normal;
            text-align: right;
            overflow: hidden;
            user-select: none;
            position: absolute;
            top: 0px;
            pointer-events: none;
            z-index: 10;
        }

        #menu {
            background-color: rgba(15, 15, 15, 0.9);
            display: none;
            border-radius: 5px;
            width: fit-content;
            position: absolute;
            top: 32px;
            right: 32px;
            z-index: 10;
        }

        #menu>ul {
            list-style: none;
            padding-left: 10px;
            padding-right: 10px;
            margin: 0px;
            min-width: 96px;
        }

        #menu>ul>li {
            border-bottom: 1px solid gray;
            margin-top: 16px;
            margin-bottom: 16px;
            cursor: pointer;
            user-select: none;
        }

        #input_abrir {
            border: 0px;
            width: calc(100% - 14px);
            opacity: 0;
            position: absolute;
        }

        #p_abrir {
            margin: 0px;

        }

        .div_ventana {
            display: none;
            background: rgba(15, 15, 15, 0.9);
            border: 1px solid white;
            border-radius: 5px;
            position: fixed;
            padding: 10px;
            top: calc((100vh - 256px) / 2);
            left: calc((100vw - 256px) / 2);
            width: calc(256px - 20px);
            height: calc(256px - 20px);
            overflow-y: auto;
            z-index: 10;
        }

        #botonesVentana {
            text-align: center;
            margin-top: 10px;
        }

        #botonesVentana>button {
            border: 1px solid red;
            margin: 5px;
            background: rgba(15, 15, 15, 0.9);
            color: rgb(200, 225, 250);
            border: 1px solid white;
            border-radius: 5px;
        }

        #inputVentana {
            background: black;
            color: rgb(200, 225, 250);
            margin-top: 5px;
        }

        #button_menu {
            background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAATklEQVRYR+3UwQ0AIAhDUbr/0GUA4pGUxO/Rg9SXBlX4KDy/CHBPwLa3eiFpfHhcEGCL//XuvRIigEBcgEUUF4h3gAAIIBDfAwSghN8JNMQgJCF5+x2IAAAAAElFTkSuQmCC');
            background-size: cover;
            background-repeat: no-repeat;
            opacity: 0.75;

            width: 32px;
            height: 32px;
            position: fixed;
            top: 32px;
            right: 32px;
            border: 1px solid white;
            border-radius: 5px;
            z-index: 20;
        }

        #li_escala {
            display: flex;
            width: 100%;
            justify-content: space-between;
            height: 24px;
        }

        #li_escala>p {
            margin: 0px;
            text-align: center;
            display: flex;
            align-items: center;
        }

        #div_textoPredictivo {
            display: none;
            position: absolute;
            background: rgb(31, 31, 31);
            height: fit-content;
            max-height: 128px;
            overflow-x: hidden;
            max-width: 256px;
            width: fit-content;
            padding: 2px;
            border-radius: 3px;
            border: 1px solid gray;
            padding: 5px;
            z-index: 10;
        }

    </style>

        <div id="enumerador_textarea"></div>

        <div id="contenedor_textarea">
            <div class="textarea" id="capa_textarea"></div>
            <div id="div_textoPredictivo"></div>
            <textarea class="textarea" spellcheck="false"></textarea>
        </div>

    <div id="menu">
        <ul>
            <li onclick="nuevo()">Nuevo</li>
            <li id="li_abrir" onclick="ocultar_elementos()"><input id="input_abrir" type="file">
                <p id="p_abrir">Abrir</p>
            </li>
            <li onclick="visualizar()">Visualizar</li>
            <li onclick="descargar()">Descargar proyecto</li>
            <li onclick="descargarSistema('DXFE')">Descargar DXFE</li>
            <li onclick="deshacer()">Deshacer</li>
            <li onclick="rehacer()">rehacer</li>
            <li id="li_escala">
                <p id="p_escala">100%</p><input id="input_escala" type="range" min="0" max="100" value="100">
            </li>
            <li onclick="copiarLinea()">Copiar linea</li>
            <li onclick="Ayuda()">Ayuda</li>
        </ul>
    </div>

    <div class="div_ventana">
        <p>Instrucciones:</p>
        <div>Presiona dos veces M para abrir menú.</div>
        <input id="inputVentana" type="text" value="index.html">
        <div id="botonesVentana"><button onclick="aceptar()">Aceptar</button><button
                onclick="cancelar()">Cancelar</button></div>
    </div>

    <div id="button_menu" onclick="menu_abrir()"></div>

    <script>
	

        let textarea = document.getElementsByTagName("textarea")[0];
        textarea.addEventListener('input', function () { ajustar_textarea(); guardarMemoria(); });
        textarea.addEventListener('click', function () {
            ocultar_elementos();
            if (contenedor_textarea.scrollTop < 48) { scrollTop = 0; contenedor_textarea.scrollTop = 0 }
        });

        let inactividad = true;
        let inactividadTime = 0;

        textarea.addEventListener('keydown', function (event) {	
		reconocerActividad();
		ocultar_elementos();
        });

        function reconocerActividad(){
            clearTimeout(inactividadTime);
            inactividad = false;
            inactividadTime = setTimeout(function () {
                inactividad = true;
                f_inactividad();
                verificarComando();
            }, 1000);
        }

        function f_inactividad() {
            funcion_textoPredictivo();
            guardarHistorialTextarea();
        }

        let memoria = {
            archivos: [{
                index: 0,
                type: "archivo",
                name: "index.html",
                content: ""
            }],
            archivoActual: {
                index: 0,
                type: "archivo",
                name: "index.html",
                content: ""
            },

            textarea: {
                index: 0,
                historial: [''],
                maxFontSize: Number(window.getComputedStyle(textarea).fontSize.match(/\d+/g)[0]),
            }
        }

        let memoriaDefault = Object.assign({}, memoria);
	

	function f_accesoCache() {
    	try {
		if (window.localStorage) { 
      		localStorage.setItem('prueba', 'valor');
      		localStorage.removeItem('prueba'); // Eliminar el elemento para no almacenar datos de forma permanente
      		return true;
		}
    	} catch (error) {
      		console.log("Sin acceso a caché: "+error);
    	}
		return false;
	}

	let accesoACache = f_accesoCache();


        function reiniciarMemoria() {
            textarea.value = "";
            textarea.style.width = "fit-content";
            textarea.style.height = "fit-content";
            memoria = Object.assign({}, memoriaDefault);
	    guardarMemoria();
	
        }
	
        function verificarCache() {
	try{
            let memoriaCacheString = localStorage.getItem('memoria');
            if (memoriaCacheString) {
                memoria = JSON.parse(memoriaCacheString);
                textarea.value = memoria.archivoActual.content;
            } else {
                reiniciarMemoria();
            }
	}catch(error){
		console.log("sin acceso a caché");
		reiniciarMemoria();
	     }
        }

        if(accesoACache){verificarCache()}

        function guardarMemoria() {
            memoria.archivoActual.content = textarea.value;
            let index = memoria.archivoActual.index;
            memoria.archivos[index] = Object.assign({}, memoria.archivoActual);
            let memoriaString = JSON.stringify(memoria);
            if(accesoACache){localStorage.setItem('memoria', memoriaString);}
        }
	
        let enumerador_textarea = {
            elemento: document.getElementById("enumerador_textarea"),
            lineas: 1,
            visible: false
        }

	function enumerarLineas(){
		let resultado = "";
		let cantidad = 2000;
		let i=1;
		if(cantidad){
			for (i = 1; i <=cantidad; i++) {
			resultado += `${i}<br>`;

		}
		enumerador_textarea.lineas = i-1;
		enumerador_textarea.elemento.innerHTML = resultado;}}

	enumerarLineas();

        let contenedor_textarea = document.getElementById("contenedor_textarea");

        contenedor_textarea.addEventListener('scroll', function () {
            let scrollTop = event.target.scrollTop;
            enumerador_textarea.elemento.style.top = -scrollTop + "px";

        });

        function verEnumerador() {
            if (enumerador_textarea.visible) {
                enumerador_textarea.visible = false;
                enumerador_textarea.elemento.style.visibility = "hidden";
            } else {
                enumerador_textarea.visible = true;
                enumerador_textarea.elemento.style.visibility = "visible";
            }
        }


        function ajustar_textarea() {
            let fontSize = parseInt(window.getComputedStyle(textarea).fontSize, 10);
            fontSize += fontSize / 8;
            let content = textarea.value;
            let lines = content.split('\n');
            let longestLine = lines.reduce((max, line) => Math.max(max, line.length), 0);
            let width = 54 + longestLine * fontSize;
            let height = 32 + lines.length * fontSize;
            height += window.innerHeight;

            textarea.style.width = `${width}px`;
            textarea.style.height = `${height}px`;
        }

        ajustar_textarea();

        let menu = {
            element: document.getElementById("menu"),
            abierto: false,
            input_abrir: document.getElementById('input_abrir'),
            button: document.getElementById("button_menu"),
            buttonVisible: true
        }


        function ocultarButtonMenu() {
            if (menu.buttonVisible) {
                menu.buttonVisible = false;
                menu.button.style.display = "none";
            } else {
                menu.buttonVisible = true;
                menu.button.style.display = "block";
            }
        }

        function menu_abrir() {
            if (menu.abierto) {
                menu.abierto = false;
                menu.element.style.display = "none";
            }
            else {
                menu.abierto = true;
                menu.element.style.display = "block";

            }
        }

        

        function ocultar_elementos() {
            menu.element.style.display = "none";
            menu.abierto = false;
            ventana.elemento.style.display = "none";
            ventana.abierta = false;
            textoPredictivo.elemento.style.display = "none";
            textoPredictivo.abierto = false;
        }

        menu.input_abrir.addEventListener('change', function (event) {
            let archivo = event.target.files[0];
            if (!archivo) { mf('¡Error! No se ha seleccionado ningún archivo.'); return }
            let reader = new FileReader();
            let tipo = archivo.type;
            if (tipo.includes("text") || tipo.includes("application/xml") || tipo.includes("application/json")) {
                reader.readAsText(archivo);
            } else {
                mf('Archivo no compatible'); return
            }
            reader.onload = function (event) {
                memoria.archivoActual.type = archivo.type;
                memoria.archivoActual.name = archivo.name;
                memoria.archivoActual.content = event.target.result;
                textarea.value = memoria.archivoActual.content;
		enumerarLineas();
                ajustarTextoPredictivo();
                guardarMemoria();

                ajustar_textarea();
            }
        });


        function descargar() {
            ventana.estado = "descargar";
            ventana.titulo = "Descargando";
            ventana.contenido = "Nombre de archivo:";
            ventana.inputNombre = true;
            ventana.botones = true;
            ventana.style = ` 
		height: fit-content;
          	width: 256px;`;
            mostrarVentana();
        }

        function visualizar() {

            let vistaPrevia = `

	<!--Edicion-->
	<style>
		#divVistaPrevia{
			position: fixed;
			top: 0px;
			right: 0px;
			background: red;
			border-radius: 5px;
			color: white;
			padding: 5px;
			pointer-events: none;
			opacity: 0.75;
            z-index: 10;
		}

        #audio_vista_previa{
            display: none;
        }
	</style>
	<div id="divVistaPrevia">Vp</div>

    <audio id="audio_vista_previa" autoplay controls src="data:audio/mpeg;base64,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">
    The “audio” tag is not supported by your browser.
    </audio>

    `+ `<` + `script>
        let audio_vista_previa = {
            elemento: document.getElementById('audio_vista_previa'),
            abierto: false
        }

        document.addEventListener('click', () => {
            if(audio_vista_previa.abierto == false){
                audio_vista_previa.elemento.play();
                audio_vista_previa.abierto=true;
            }
        });
    `+ `<` + `/script>

	<!--Fin edicion-->`;

            let htmlString = textarea.value;
            if (htmlString.indexOf("<body>")) {
                htmlString = htmlString.replace("<body>", "<body>" + vistaPrevia);
            }
            const blob = new Blob([htmlString], { type: 'text/html' });
            const urlData = URL.createObjectURL(blob);
            const newWindow = window.open(urlData, '_blank');
            newWindow.addEventListener('load', function () { URL.revokeObjectURL(urlData); });
        }


        document.addEventListener('keydown', function (event) {
            if (event.keyCode == 13) {
                if (textoPredictivo.abierto) { event.preventDefault(); aceptar() }
                if (ventana.abierta) {
                    event.preventDefault();
                    aceptar();
                }
            }

            if (event.key === 'Tab') {
                event.preventDefault();
                tabular();
            }

        }, true);

        
        let arregloComandos = [];

	function indiceComando(comando){
  	let indiceElemento = 0;
	  for (const elemento of arregloComandos) {
	    if (elemento.codigo == comando) {
	      return indiceElemento;
    		}
	    indiceElemento++;
  		}
	  return -1;
	}

        function verificarComando() {
            const selectionStart = textarea.selectionStart;
            const selectionEnd = textarea.selectionEnd;
	    let posicionCentral = textarea.selectionStart;
	    let posicionInicial = 0;
	    if(textarea.value[posicionCentral-1]!="."){return}
	    for(let i = posicionCentral-2; i>0 ;i--)
	    {
		if(textarea.value[i]=="."){posicionInicial = i; break}
	    }
	    
            let ultimos_caracteres = textarea.value.substring(posicionInicial, selectionStart);
	    let cantidad = ultimos_caracteres.length;
            if (indiceComando(ultimos_caracteres.toUpperCase())!=-1) {
                ultimos_caracteres = ultimos_caracteres.toUpperCase();
            }
            else if (indiceComando(ultimos_caracteres.toLowerCase())!=-1) {
                ultimos_caracteres = ultimos_caracteres.toLowerCase();
            } else {
                return
            }

            let indiceElemento = indiceComando(ultimos_caracteres);
            textarea.value = textarea.value.substring(0, selectionStart - cantidad) + textarea.value.substring(selectionEnd);
            textarea.selectionStart = selectionStart - cantidad;
            textarea.selectionEnd = selectionStart - cantidad;

            arregloComandos[indiceElemento].funcion();

            guardarMemoria();

        }

        function asignarAccion(codigo, accion, funcion) {
	    let indice = arregloComandos.length;
	    arregloComandos.push({codigo:codigo, accion: accion, funcion: funcion});
        }

        asignarAccion(".a.","Ayuda", function () { Ayuda() });
        asignarAccion(".m.","Menu",function () { menu_abrir() });
        asignarAccion(".t.","Tabular", function () { tabular() });
	asignarAccion(".ct.","Corregir tabulacion",function () { corregirTabulacion()});
        asignarAccion(".v.","Visualizar proyecto", function () { visualizar() });
        asignarAccion(".d.","Descargar proyecto", function () { descargar() });
        asignarAccion(".ds.","Descargar sistema", function () { descargarSistema() });
        asignarAccion(".p.","Pantalla completa", function () { pantallaCompleta(document.documentElement) });
        asignarAccion(".e.","Enumerar", function () { verEnumerador() });
        asignarAccion(".n.","Nuevo", function () { nuevo() });
        asignarAccion(".b.","Ocular boton menú", function () { ocultarButtonMenu() });
        asignarAccion(".il.","Inicio de linea", function () { cursorInicioLinea(); contenedor_textarea.scrollLeft = 0});
        asignarAccion(".fl.","Final de linea", function () { cursorFinalLinea(); let distancia = stringSize(lineaActualRecortada().ajuste,textarea).width; if(distancia>window.innerWidth-64){contenedor_textarea.scrollLeft = -32+distancia}});
        asignarAccion(".it.","Inicio de textarea", function () { cursorInicioTextarea(); contenedor_textarea.scrollTop = 0;contenedor_textarea.scrollLeft=0});
        asignarAccion(".ft.","Final de textarea", function () { cursorFinalTextarea(); let distancia = stringSize(parrafoActual().ajuste,textarea).height; if(distancia>window.innerHeight-128){contenedor_textarea.scrollTop = -54+distancia}});
        asignarAccion(".sp.","Seleccionar parrafo", function () { seleccionarParrafo() });
	asignarAccion(".sl.","Seleccionar linea",function () { seleccionarLinea() });
	asignarAccion(".st.","Seleccionar todo",function () { seleccionarTodo() });

        let ventana = {
            abierta: false,
            elemento: document.getElementsByClassName("div_ventana")[0],
            style: "",
        }

        ventana.elementos = ventana.elemento.children;

        function mostrarVentana() {
            ventana.abierta = true;
            ventana.elemento.style = ventana.style;
            ventana.elemento.style.display = "block";

            for (let i = 0; i < ventana.elementos.length; i += 1) { ventana.elementos[i].style.display = "none" }
            if (ventana.titulo != "") {
                ventana.elementos[0].style.display = "block";
                ventana.elementos[0].innerHTML = ventana.titulo;
            }
            if (ventana.contenido != "") {
                ventana.elementos[1].style.display = "block";
                ventana.elementos[1].innerHTML = ventana.contenido;
            }
            if (ventana.inputNombre) {
                ventana.elementos[2].style.display = "block";
                ventana.elementos[2].value = memoria.archivoActual.name;
            }
            if (ventana.botones) {
                ventana.elementos[3].style.display = "block";
            }
        }

        function Ayuda() {
            ventana.estado = "Ayuda";
            ventana.titulo = "Ayuda";
            ventana.contenido = `Comandos útiles: <br><br>`;

	    for(let i = 0; i<arregloComandos.length; i++)
	    {
	    	ventana.contenido+= arregloComandos[i].codigo+": "+arregloComandos[i].accion+".<br>";
	    }
    
            ventana.inputNombre = false;
            ventana.botones = false;
            ventana.style = `
    height: 256px;
    width: 256px;`;
            mostrarVentana();
        }

        function nuevo() {
            ventana.estado = "nuevo";
            ventana.titulo = "Crear nuevo proyecto";
            ventana.contenido = "¿Quieres borrar la caché y el proyecto actual para crear un proyecto nuevo?";
            ventana.inputNombre = false;
            ventana.botones = true;
            ventana.style = `
		height: fit-content;
            	width: 256px;`;
            mostrarVentana();
        }

        function aceptar() {
            if (ventana.abierta) {
                let estado = ventana.estado;
                if (estado == "nuevo") { reiniciarMemoria();}

                if (estado == "descargar") {
                    const html = textarea.value;
                    const dataUrl = `data:text/html;charset=utf-8,${encodeURIComponent(html)}`;
                    const enlaceDescarga = document.createElement('a');
                    enlaceDescarga.href = dataUrl;
                    enlaceDescarga.download = ventana.elementos[2].value;
                    enlaceDescarga.click();
                }
            }

            if (textoPredictivo.abierto) {
                seleccionarTextoPredictivo(0);
            }
            ocultar_elementos();
        }

        function cancelar() {ocultar_elementos(); }

        //-texto predictivo

        let textoPredictivo = {
            elemento: document.getElementById("div_textoPredictivo"),
            abierto: false,
            arreglo: [],
            arregloActual: [],
            textoEscrito: "",
            textoSeleccionado: "",
            arreglos: {
                listener: ["click", "dblclick", "mousedown", "mouseup", "mousemove", "mouseover", "mouseout", "keydown", "keyup", "keypress", "focus", "blur", "change", "input", "submit", "error", "abort", "load", "unload", "resize", "scroll", "orientationchange", "touchstart", "touchmove", "touchend", "touchcancel", "gamepadconnected", "gamepaddisconnected"],
                listenerAddEvent: ["addEventListener", "removeEventListener", "dispatchEvent", "target", "currentTarget", "bubbles", "cancelable", "composed", "returnValue", "defaultPrevented", "eventPhase", "timeStamp", "srcElement", "type"],
                etiquetasHtml: ["&lt!DOCTYPE html&gt", "&lthtml&gt", "&lthead&gt", "&lttitle&gt", "&ltmeta&gt", "&ltlink&gt", "&ltstyle&gt", "&ltscript&gt", "&lt/head&gt", "&ltbody&gt", "&lth1&gt", "&lth2&gt", "&lth3&gt", "&lth4&gt", "&lth5&gt", "&lth6&gt", "&ltp&gt", "&ltbr&gt", "&lthr&gt", "&ltimg&gt", "&lta&gt", "&ltstrong&gt", "&ltem&gt", "&ltul&gt", "&ltol&gt", "&ltli&gt", "&ltdl&gt", "&ltdt&gt", "&ltdd&gt", "&ltpre&gt", "&ltcode&gt", "&ltspan&gt", "&ltdiv&gt", "&lttable&gt", "&ltcaption&gt", "&ltthead&gt", "&lttbody&gt", "&lttfoot&gt", "&lttr&gt", "&ltth&gt", "&lttd&gt", "&ltform&gt", "&ltlabel&gt", "&ltinput&gt", "&ltselect&gt", "&ltoption&gt", "&lttextarea&gt", "&ltbutton&gt", "&ltiframe&gt", "&ltembed&gt", "&ltobject&gt", "&ltvideo&gt", "&ltaudio&gt", "&ltmap&gt", "&ltarea&gt", "&ltcanvas&gt", "&ltprogress&gt", "&ltmeter&gt", "&ltdetails&gt", "&ltsummary&gt", "&ltmenu&gt", "&ltcommand&gt", "&ltdatalist&gt", "&ltkeygen&gt", "&ltoutput&gt", "&lttrack&gt", "&ltsource&gt"],
                atributosHtml: ["accesskey", "align", "alt", "archive", "async", "autocapitalize", "autocomplete", "autofocus", "autoplay", "background", "bgcolor", "border", "buffered", "challenge", "charset", "checked", "cite", "class", "cols", "colspan", "content", "contenteditable", "controls", "coords", "crossorigin", "csp", "currentitem", "data", "datalist", "datetime", "default", "defer", "disabled", "download", "draggable", "dropzone", "enctype", "enterkeyhint", "face", "for", "form", "formaction", "formenctype", "formmethod", "formtarget", "frameborder", "headers", "height", "hidden", "high", "hspace", "icon", "id", "incremental", "indeterminate", "ismap", "key", "keydown", "keypress", "keyup", "lang", "language", "lazyload", "length", "list", "loop", "low", "max", "maxlength", "minlength", "multiple", "muted", "name", "nav", "nonce", "noscript", "nowrap", "open", "optimum", "order", "orient", "outerHTML", "outerText", "padding", "page", "pageincrement", "pagemax", "pagemin", "pageside", "pagesize", "panel", "placeholder", "ping", "play", "poster", "preload", "profile", "prompt", "public", "query", "radiogroup", "readonly", "referrerpolicy", "rel", "remote", "required", "resize", "reversed", "rows", "rowspan", "sandbox", "scope", "screen", "scriptable", "seamless", "selected", "selectiondirection", "size", "sizes", "slot", "sortable", "source", "spellcheck", "src", "srcdoc", "srclang", "standby", "start", "status", "style", "summary", "TabIndex", "target", "textarea", "text", "title", "to", "translate", "type", "ultralong", "unicode", "usemap", "value", "var", "version", "verticalalign", "viewbox", "visible", "width", "wrap", "wrongtext"],
                varios: ["&ltmeta name='viewport' content='width=device-width, initial-scale=1.0'>", "data:image/png;base64,[BASE64_IMAGE]", "lang='es'", "<meta charset='utf-8'>", "document", "documentElement", "getElementById", "getElementsByTagName", "getElementsByClassName", "children", "src", "href", "bottom", "function", "link", "rel", "onclick"],
                cssKeywords: ["absolute", "align-content", "align-items", "align-self", "all", "alternate", "animation", "animation-delay", "animation-direction", "animation-duration", "animation-fill-mode", "animation-iteration-count", "animation-name", "animation-play-state", "animation-timing-function", "appearance", "aspect-ratio", "auto", "background", "background-attachment", "background-blend-mode", "background-clip", "background-color", "background-image", "background-origin", "background-position", "background-repeat", "background-size", "backface-visibility", "balance", "baseline", "before", "border", "border-bottom", "border-bottom-color", "border-bottom-left-radius", "border-bottom-right-radius", "border-bottom-style", "border-bottom-width", "border-collapse", "border-color", "border-image", "border-image-source", "border-image-slice", "border-image-width", "border-image-repeat", "border-inline", "border-inline-color", "border-inline-end", "border-inline-end-radius", "border-inline-start", "border-inline-start-radius", "border-inline-style", "border-inline-width", "border-left", "border-left-color", "border-left-radius", "border-left-style", "border-left-width", "border-radius", "border-right", "border-right-color", "border-right-radius", "border-right-style", "border-right-width", "border-spacing", "border-style", "border-top", "border-top-color", "border-top-left-radius", "border-top-right-radius", "border-top-style", "border-top-width", "border-width", "bottom", "box-decoration-break", "box-decoration-line", "box-decoration-style", "box-shadow", "box-sizing", "break-after", "break-before", "break-inside", "calc", "caption", "caret-color", "center", "character-range", "character-set", "clear", "clip", "clip-path", "color", "column-count", "column-fill", "column-gap", "column-rule", "column-rule-color", "column-rule-style", "column-rule-width", "columns", "content", "counter-increment", "counter-reset", "cursor", "data", "direction", "display", "drop-shadow", "element", "empty-cells", "fill", "filter", "flex", "flex-basis", "flex-direction", "flex-flow", "flex-grow", "flex-shrink", "flex-wrap", "float", "font", "font-family", "font-feature-settings", "font-kerning", "font-language-overrides", "font-light", "font-line-height", "font-margin", "font-max-lines", "font-optical-size-adjust", "font-palette", "font-size", "font-size-adjust", "font-slant", "font-style", "gap", "grid", "grid-area", "grid-auto-columns", "grid-auto-flow", "grid-auto-rows", "grid-column", "grid-column-gap", "grid-column-start", "grid-column-end", "grid-content", "grid-gap", "grid-layout", "grid-line", "grid-row", "grid-row-gap", "grid-row-start", "grid-row-end", "grid-template", "grid-template-areas", "grid-template-columns", "grid-template-rows", "hanging-punctuation", "height", "hidden", "highlight", "hyphenation", "icon", "image-orientation", "image-rendering", "image-set", "initial", "inline", "inline-block", "inline-flex", "inline-grid", "input", "inset", "isolation", "justify-content", "justify-items", "justify-self", "kerning", "left", "letter-spacing", "line-break", "line-height", "linear-gradient", "list-style", "list-style-image", "list-style-position", "list-style-type", "local", "look-ahead", "low", "margin", "margin-bottom", "margin-left", "margin-right", "margin-top", "marker", "marker-align", "marker-offset", "marker-orientation", "mask", "mask-border", "mask-border-mode", "mask-border-slice", "mask-clip", "mask-composite", "mask-image", "mask-mode", "mask-origin", "mask-position", "mask-repeat", "mask-size", "max", "max-content", "max-height", "max-inline-size", "max-width", "min", "min-content", "min-height", "min-inline-size", "min-width", "mix-blend-mode", "move-to-edge", "multiple", "nav", "negative", "newline-in-hinti", "no-display", "normal", "not-normal", "object-fit", "object-position", "opacity", "order", "orphan", "outline", "outline-color", "outline-offset", "outline-style", "outline-width", "overflow", "overflow-x", "overflow-y", "padding", "padding-bottom", "padding-left", "padding-right", "padding-top", "page", "page-break-after", "page-break-before", "page-break-inside", "page-size", "paint-order", "palettes", "perspective", "perspective-origin", "pointer-events", "position", "post-hyphens", "pre", "pre-break", "pre-wrap", "print", "progress", "proportions", "pseudo", "punctuation", "radial-gradient", "range", "ratio", "reattachment", "reflect", "reflow", "region", "relative", "repeat", "repeating-linear-gradient", "resize", "rest", "revert", "revolution", "right", "rotation", "scrollbar-color", "scrollbar-width", "scroll-behavior", "scroll-edge-distance", "scroll-logical-position", "scroll-margin", "scroll-padding", "scroll-snap-align", "scroll-snap-destination", "scroll-snap-points", "scroll-snap-type", "scroll-top", "scroll-zoom", "selection", "shape-image-type", "shape-margin", "shape-outside", "shape-padding", "size", "speak-as-coordinates", "speak-numerals", "speak-punctuation", "speech-level", "src", "status", "stretch", "stroke", "stroke-dasharray", "stroke-dashoffset", "stroke-linecap", "stroke-linejoin", "stroke-miterlimit", "stroke-opacity", "stroke-width", "style", "sub", "super", "table-caption", "table-cell", "table-column", "table-footer", "table-header", "table-layout", "table-row", "tab-size", "target", "text", "text-align", "text-align-last", "text-decoration", "text-decoration-color", "text-decoration-line", "text-decoration-style", "text-decoration-thickness", "text-indent", "text-justify", "text-line-break", "text-overflow", "text-rendering", "text-shadow", "text-size-adjust", "text-transform", "text-underline-position", "text-wrap", "timing-functions", "top", "transform", "transform-box", "transform-origin", "transform-style", "transition", "transition-delay", "transition-duration", "transition-property", "transition-timing-function", "translate", "translate3d", "turn", "underline", "unset", "url", "user-select", "var", "vertical-align", "vertical-hanging-punctuation", "visibility", "white-space", "widows", "width", "word-break", "word-spacing", "wrap-flow", "wrap-margin", "writing-mode", "z-index"],
                cssColors: ["black", "white", "red", "green", "blue", "yellow", "orange", "purple", "pink", "fuchsia", "teal", "cyan", "magenta", "lime", "olive", "maroon", "navy", "gray", "silver", "gold", "brown", "transparent", "darkred", "darkgreen", "darkblue", "lightskyblue", "royalblue", "lightcoral", "coral", "tomato", "darkviolet", "lightgreen", "darkgoldenrod", "lightgoldenrodyellow",],
                javascriptKeywords: ["abstract", "arguments", "await", "boolean", "break", "byte", "case", "catch", "class", "const", "continue", "debugger", "default", "delete", "do", "else", "enum", "export", "extends", "false", "finally", "float", "for", "function", "goto", "if", "implements", "import", "in", "instanceof", "interface", "int", "let", "logical", "null", "number", "of", "package", "private", "protected", "public", "readonly", "return", "short", "signed", "static", "super", "switch", "synchronized", "this", "throw", "throws", "true", "try", "typeof", "undefined", "var", "void", "volatile", "while", "with", "yield", "add", "addEventListener", "alert", "all", "anchor", "animation", "apply", "Array", "arguments", "assign", "async", "atob", "attachEvent", "auto", "backgroundColor", "backgroundImage", "backgroundPosition", "backgroundRepeat", "backgroundSize", "Behavior", "before", "beginUpdate", "beginPath", "bezierCurveTo", "big", "bind", "blob", "blur", "body", "Boolean", "borderColor", "borderBottom", "borderBox", "borderCollapse", "borderRadius", "borderImage", "borderLeft", "borderLineStyle", "borderPadding", "borderRight", "borderSpacing", "BorderStyle", "borderTop", "borderWidth", "boxShadow", "break", "buffer", "button", "byteLength", "C", "cache", "call", "caller", "cancelAnimationFrame", "canvas", "captureEvents", "case", "catch", "ceil", "clearInterval", "clearTimeout", "center", "charAt", "charCodeAt", "charCode", "checked", "childElementCount", "childNodes", "classList", "click", "clearInterval", "clearTimeout", "close", "charCodeAt", "collapse", "color", "cols", "colgroup", "command", "Comment", "compareDocumentPosition", "complete", "concat", "conditional", "confirm", "connect", "connected", "connection", "console", "constructor", "contains", "content", "contentWindow", "context", "control", "coordinates", "copy", "cos", "count", "createAttribute", "createCDATASection", "createElement", "createDocumentFragment", "createEvent", "createLSInput", "createLSOutput", "createNSResolver", "createTextNode", "createXPath", "crossOrigin", "CSS", "CSSOM", "crypto", "cssText", "currentTarget", "customElements", "data", "dataset", "Date", "decodeURI", "decodeURIComponent", "defaultValue", "defer", "deleteRow", "deleteCell", "depth", "detachEvent", "dispatchEvent"],
                javascriptControlStructures: ["if", "else", "elseif", "switch", "case", "default", "ternaryoperator", "for", "while", "do-while", "for...in", "for...of", "break", "continue", "try", "catch", "finally", "label", "goto"],
                selectElementMethods: ["getElementById", "getElementsByTagName", "getElementsByClassName", "querySelector", "querySelectorAll", "Element.querySelector", "Element.querySelectorAll", "Element.closest", "Element.matches",],
		date: ["requestAnimationFrame","setTimeout","setInterval","getTime","setTime","getFullYear","getMonth","getDate","getHours","getMinutes","getSeconds","getMilliseconds","getDay","toLocaleString","moment","isMoment","locale","format","add","subtract","utc","parse","format","add","subtract","isBefore","isAfter","isEqual","now","toDate","isDate","format","addYears","addMonths","addDays","addHours","addMinutes","addSeconds","string"],
            }
        }

        let palabrasClave={
            js:{
                reservadas:["abstract","arguments","boolean","break","case","catch","class","const","continue","debugger","default","delete","do","else","enum","export","extends","false","finally","for","function","goto","if","implements","import","in","instanceof","interface","let","new","null","package","private","protected","public","return","super","switch","this","throw","true","try","typeof","var","void","while","with","yield"],
                ECMAScript5y6:["await","class*","const*","delete*","export*","extends*","finally*","for*","function*","import*","in*","instanceof*","interface*","let*","new*","null*","package*","private*","protected*","public*","return*","super*","switch*","this*","throw*","true*","try*","typeof*","var*","void*","while*","with*","yield*"],
                operadores:["+","-","*","/","%","++","--","===","!==","==","!=","<",">","<=",">=","&&","||","!","?",":"],
                literales:["string","true","false","null","undefined","123","3.14"],
                funciones:[],
                objetosYarrays:["{}","[]"],
                estructurasDeControl:["if","for","while","switch","break","case","default"],
                funcionesAnonimas:["=>"],
                promesasModulosYexcepciones:['try','catch','finally',"new","Promise","then","import","export","from","undefined","NaN","Infinity"],
                herramientas:["console.log","debugger"],
            },
            css:{
                palabrasClaves:["auto","initial","inherit"],
                propiedades:["color","font-size","font-family","font-weight","background-color","background-image","text-align","text-decoration","margin","padding","border","display","position","float","clear","width","height","max-width","max-height","min-width","min-height","overflow","visibility","opacity","z-index"],
                unidadesDeMedida:["px","em","rem","%","vw","vh"],
                posicionamiento:["absolute","fixed","sticky","top","bottom","left","right","static","relative","inherit"],
                boxModel:["content","padding","border","margin"],
                tipografia:["font-family","font-size","font-weight","font-style","line-height","letter-spacing","text-align","text-decoration","text-transform"],
                color:["color","background-color","rgb","background-position"],
                imagenes:["background-image","background-size","background-repeat","background-position"],
                listas:["list-style-type","list-style-position","list-style-image"],
                tablas:["border-collapse","border-spacing"],
                formularios:["input-type","input-placeholder","input-size","input-color","border","padding"],
                animaciones:["animation-name","animation-duration","animation-delay","animation-iteration-count","animation-fill-mode"],
                transiciones:["transition-property","transition-duration","transition-timing-function","transition-delaytransition-property","transition-duration","transition-timing-function","transition-delay"],
                medidasPantalla:["@media"],
                fexBox:["flex","flex-direction","justify-content","align-items","flex-wrap"],
                gridLayout:["grid","grid-template-columns","grid-template-rows","grid-gap"],
            },
            html:{
                etiquetas:["&lt!DOCTYPE html&gt","&lthtml&gt","&lt/html&gt","&lthead&gt","&lt/head&gt","&lttitle&gt","&lt/title&gt","&ltbody&gt","&lt/body&gt","&lth1&gt","&lt/h1&gt","&lth2&gt","&lt/h2&gt","&lth3&gt","&lt/h3&gt","&lth4&gt","&lt/h4&gt","&lth5&gt","&lt/h5&gt","&lth6&gt","&lt/h6&gt","&ltp&gt","&lt/p&gt","&ltimg&gt","&lta&gt","&lt/a&gt","&ltul&gt","&lt/ul&gt","&ltol&gt","&lt/ol&gt","&ltli&gt","&lt/li&gt","&lttable&gt","&lt/table&gt","&lttr&gt","&lt/tr&gt","&ltth&gt","&lt/th&gt","&lttd&gt","&lt/td&gt","&ltform&gt","&lt/form&gt","&ltinput&gt","&lttextarea&gt","&ltselect&gt","&lt/select&gt","&ltoption&gt","&lt/option&gt","&ltbutton&gt","&lt/button&gt","&ltlabel&gt","&lt/label&gt","&ltdiv&gt","&lt/div&gt","&ltspan&gt","&lt/span&gt","&ltbr&gt","&lthr&gt","&ltpre&gt","&lt/pre&gt","&ltcode&gt","&lt/code&gt","&ltimg&gt","&ltvideo&gt","&lt/video&gt","&ltaudio&gt","&lt/audio&gt","&ltsvg&gt","&lt/svg&gt","&ltcanvas&gt","&lt/canvas&gt","&ltlink&gt","&ltmeta&gt","&ltstyle&gt","&lt/style&gt","&ltscript&gt","&lt/script&gt","&ltnoscript&gt","&lt/noscript&gt","&ltiframe&gt","&lt/iframe&gt","&ltembed&gt","&lt/embed&gt","&ltobject&gt","&lt/object&gt","&ltparam&gt","&lt/param&gt","&ltsource&gt","&lt/source&gt","&lttrack&gt","&lt/track&gt","&ltcommand&gt","&lt/command&gt","&ltkeygen&gt","&lt/keygen&gt","&ltdatalist&gt","&lt/datalist&gt","&ltmenu&gt","&lt/menu&gt","&ltdetails&gt","&lt/details&gt","&ltsummary&gt","&lt/summary&gt","&ltfigure&gt","&lt/figure&gt","&ltfigcaption&gt","&lt/figcaption&gt","&ltaside&gt","&lt/aside&gt","&ltarticle&gt","&lt/article&gt","&ltnav&gt","&lt/nav&gt","&ltsection&gt","&lt/section&gt","&ltheader&gt","&lt/header&gt","&ltfooter&gt","&lt/footer&gt","&ltaddress&gt","&lt/address&gt","&ltmark&gt","&lt/mark&gt","&ltruby&gt","&lt/ruby&gt","&ltrt&gt","&lt/rt&gt","&ltrp&gt","&lt/rp&gt","&ltins&gt","&lt/ins&gt","&ltdel&gt","&lt/del&gt","&lts&gt","&lt/s&gt","&ltstrong&gt","&lt/strong&gt","&ltem&gt","&lt/em&gt","&ltkbd&gt","&lt/kbd&gt","&ltsamp&gt","&lt/samp&gt","&ltvar&gt","&lt/var&gt","&ltcite&gt","&lt/cite&gt","&ltq&gt","&lt/q&gt","&ltdfn&gt","&lt/dfn&gt","&ltabbr&gt","&lt/abbr&gt","&ltcodeset&gt","&lt/codeset&gt","&ltsub&gt","&lt/sub&gt","&ltsup&gt","&lt/sup&gt","&lttime&gt","&lt/time&gt","&ltbdo&gt","&lt/bdo&gt"],
                atributos:["accesskey","class",'onclick',"contenteditable","dir","hidden","id","lang","style","tabindex","title","translate","href","target","download","rel","type","coords","shape","hreflang","alt","src","controls","autoplay","loop","muted","preload","mediagroup","crossorigin","value","list","type","readonly","required","span","align","compact","cite","lang","type","value","icon","label","open","width","height","type","name","enctype","target","autocomplete","accept-charset","onsabmit","onreset","align","size","width","color","lang","dir","profile","src","name","width","height","frameborder","scrolling","allowfullscreen","mozallowfullscreen","webkitallowfullscreen","sandbox","seamless","allowtransparency","border","hspace","vspace","usemap","ismap","type","checked","disabled","autofocus","min","max","step","pattern","autocomplete","placeholder","size","maxlength","accept","multiple","keytype","challenge","for","value","type","start","type","label","disabled","selected","for","name","value","max","low","high","optimum","role","href","data","width","height","usemap","ismap","tabindex","align","border","hspace","vspace","reversed","value","name","size","multiple","disabled","autofocus","required","src","type","media","align","scope","type","media","scoped","scope","datetime","text","align","valign","bgcolor","scope","headers","colspan","rowspan","kind","src","srclang","label","default"],
            }
        }


        let palabrasSegundoLote = [];

        function escanearPalabras(objeto){
            let claves = Object.keys(objeto);
            for(let clave of claves)
            {
                if(typeof objeto[clave] === 'object'){
                    let claves2 = Object.keys(objeto[clave]);
                    for(let clave2 of claves2)
                    {
                        let claves3 = objeto[clave][clave2];
                        for(let elemento of claves3)
                        {
                            palabrasSegundoLote.push(elemento);
                        }
                    }
                }
            }
        }

        escanearPalabras(palabrasClave);
        textoPredictivo.arreglos["palabrasSegundoLote"] = palabrasSegundoLote;

        function integrarArreglos() {
            const arregloPrincipal = textoPredictivo.arreglo; // Referencia al arreglo principal
            for (const propiedad in textoPredictivo.arreglos) {
                if (Array.isArray(textoPredictivo.arreglos[propiedad])) {
                    const arregloAnidado = textoPredictivo.arreglos[propiedad]; // Referencia al arreglo anidado
                    for (const elemento of arregloAnidado) {
                        arregloPrincipal.push(elemento); // Agregar elemento al arreglo principal
                    }
                }
            }
        }

        integrarArreglos();

        function ajustarTextoPredictivo() {
            textoPredictivo.arreglo = unirArreglos(textoPredictivo.arreglo, palabrasHtml(textarea.value));
            ordenAlfabeticoArreglo(textoPredictivo.arreglo);
            textoPredictivo.arreglo = eliminarRepetidosArreglo(textoPredictivo.arreglo);
        }

        ajustarTextoPredictivo();

        function funcion_textoPredictivo() {
            let textoPresente = textarea.value.substr(0, textarea.selectionStart);
            textoPredictivo.textoEscrito = ultimaPalabraEscrita(textoPresente);
            let palabra = textoPredictivo.textoEscrito;
            let ultimoCaracter = f_ultimoCaracter(textoPresente);
            if (palabra.length) {
                if (caracterPermitido(ultimoCaracter)) {
                    let arregloSalida = encontrarCoincidencias(palabra, textoPredictivo.arreglo);
                    arregloSalida = organizarSegunPalabra(palabra, arregloSalida);
                    if (arregloSalida.length > 0) {
                        textoPredictivo.arregloActual = copiarArreglo(arregloSalida);
                        mostrarTextoPredictivo();
                        return
                    }
                    else {
                        if (textoPredictivo.abierto) {
                            ocultar_elementos();
                        }

                    }

                    return
                }
            }
            //ocultar_elementos();
        }

        function mostrarTextoPredictivo() {
            textoPredictivo.abierto = true;
            textoPredictivo.elemento.style.display = "block";
            let contenido = "<ul style='list-style: none; padding: 0px; margin:0px;'>";
            for (let i = 0; i < textoPredictivo.arregloActual.length; i++) {
                contenido += `<li style='margin-bottom: 16px; cursor: pointer;' onclick='seleccionarTextoPredictivo(` + i + `)'>` + textoPredictivo.arregloActual[i] + "</li>";
            }
            contenido += "</ul>";
            textoPredictivo.elemento.innerHTML = contenido;

            let fontSize = getFontSize(textarea);

            textoPredictivo.elemento.style.left = 54 + posicionXYcursor().x + "px";
            textoPredictivo.elemento.style.top = 32 + posicionXYcursor().y + fontSize + "px";

        }

        function seleccionarTextoPredictivo(index) {
            reconocerActividad();
            let textoEscrito = textoPredictivo.textoEscrito;
            let length = textoEscrito.length;
            let palabraCorregida = cambiarEntidadesPorCaracteres(textoPredictivo.arregloActual[index]);
            const selectionStart = textarea.selectionStart;
            const selectionEnd = textarea.selectionEnd;

            // Insertar la palabra en la posición del cursor
            textarea.value = textarea.value.substring(0, selectionStart - length) + palabraCorregida + textarea.value.substring(selectionEnd);
            ocultar_elementos();
            textarea.selectionStart = selectionStart - length + palabraCorregida.length;
            textarea.selectionEnd = textarea.selectionStart;
            textarea.focus();
        }

        //Funciones utiles:
        function descargarAudioBase64(base64string) {const byteNumbers=atob(base64string.split(',')[1]);const arrayBuffer=new ArrayBuffer(byteNumbers.length);const uint8Array=new Uint8Array(arrayBuffer);for(let i=0;i<byteNumbers.length;i++){uint8Array[i]=byteNumbers.charCodeAt(i);}const blob=new Blob([uint8Array],{type:'audio/mpeg'});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download='audio.mp3';a.click();}
        function descargarImagenBase64(base64string){const byteNumbers=atob(base64string.split(',')[1]);const arrayBuffer=new ArrayBuffer(byteNumbers.length);const uint8Array=new Uint8Array(arrayBuffer);for(let i=0;i<byteNumbers.length;i++){uint8Array[i]=byteNumbers.charCodeAt(i);}const blob=new Blob([uint8Array],{type:'image/jpeg'});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download='image.jpg';a.click();}
        function pantallaCompleta(elemento) {if (!document.fullscreenElement) {if (elemento.requestFullscreen) {elemento.requestFullscreen();} else if (elemento.webkitRequestFullscreen) {elemento.webkitRequestFullscreen();} else if (elemento.mozRequestFullScreen) {elemento.mozRequestFullScreen();} else {console.log("El elemento no admite pantalla completa");}} else {try { document.exitFullscreen(); } catch (error) { try { document.webkitExitFullscreen(); } catch (error) { try { document.msExitFullscreen(); } catch (error) { try { document.mozExitFullscreen(); } catch (error) { console.error("No se pudo salir del modo de pantalla completa"); return; } } } }}}
        function tabular() {if (!textarea.onfocus) {textarea.focus();}const selectionStart = textarea.selectionStart;const selectionEnd = textarea.selectionEnd;const tab = '\t';textarea.value = textarea.value.substring(0, selectionStart) + tab + textarea.value.substring(selectionEnd);textarea.selectionStart = selectionStart + tab.length;textarea.selectionEnd = textarea.selectionStart;}
        function mf(str) {const div = document.createElement('div');div.className = 'mensaje_flotante';div.style = `position: fixed;background: rgba(12, 11, 11,0.9);border-radius: 5px;color: white;padding: 5px;padding-left: 10px;padding-right: 10px;left: 5px;top: 32px;z-index: 1000`;div.textContent = str;const existingElements = document.querySelectorAll('.mensaje_flotante');let topPosition = 32;if (existingElements.length > 0) {const lastElement = existingElements[existingElements.length - 1];const lastElementTop = parseInt(lastElement.style.top, 10) || 5;topPosition = lastElementTop + 32;}div.style.top = `${topPosition}px`;document.body.appendChild(div);setTimeout(() => {document.body.removeChild(div);}, 2500);}
        function cambiarEntidadesPorCaracteres(texto) { const entidades = { "&lt": "<", "&gt": ">", "&amp": "&", "&quot": "\"", "&apos": "'" }; for (const entidad in entidades) while (texto.includes(entidad)) texto = texto.replace(entidad, entidades[entidad]); return texto; }
        function cambiarCaracteresPorEntidades(texto) { const entidades = { "<": "&lt;", ">": "&gt;", "&": "&amp;", "\"": "&quot;", "'": "&apos;" }; for (const entidad in entidades) texto = texto.replace(new RegExp(entidades[entidad], "g"), entidad); return texto; }
        function f_ultimoCaracter(cadena) { return cadena[cadena.length - 1] }//ultimo caracter de una cadena
        function caracterPermitido(str) { str = str.trim(); const ultimoCaracter = str.charAt(str.length - 1); const caracteresNoPermitidos = " .\n"; return !caracteresNoPermitidos.includes(ultimoCaracter) }
        function strExisteEnArregloSome(str, arreglo) { return arreglo.some(elemento => elemento === str) }//si existe en arreglo
        function existeClaveObjeto(strClave, objeto) { return strClave in objeto }
        function cantidadClavesObjeto(objeto) { return Object.keys(objeto).length; }
        function arregloClavesObjeto(objeto) { return Object.keys(objeto) }
        function sortearArreglo(arreglo) { const longitud = arreglo.length; for (let i = longitud - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1));[arreglo[i], arreglo[j]] = [arreglo[j], arreglo[i]]; } return arreglo; }
        function ordenAlfabeticoArreglo(arreglo) { arreglo.sort((a, b) => { if (a.toLowerCase() < b.toLowerCase()) { return -1; } else if (a.toLowerCase() > b.toLowerCase()) { return 1; } else { return 0; } }); }
        function unirArreglos(arreglo1, arreglo2) { return arreglo1.concat(arreglo2) }
        function descargarSistema(nombre) {const contenido = `<!DOCTYPE html>\n`+ document.documentElement.outerHTML;const blob = new Blob([contenido], { type: 'text/html' });const enlace = document.createElement('a');enlace.href = URL.createObjectURL(blob);enlace.download = 'DXFE.html';enlace.click();}
        function eliminarRepetidosArreglo(arreglo) {const unico = {};const resultado = [];for (const elemento of arreglo) {if (!unico.hasOwnProperty(elemento)) {unico[elemento] = true;resultado.push(elemento);}}return resultado;}
        function organizarSegunPalabra(palabra, arreglo) {const resultado = arreglo.sort((a, b) => {const posicionA = a.toLowerCase().indexOf(palabra.toLowerCase());const posicionB = b.toLowerCase().indexOf(palabra.toLowerCase());if (posicionA === -1 && posicionB === -1) {return 0;} else if (posicionA === -1) {return 1;} else if (posicionB === -1) {return -1;} else {return posicionA - posicionB;}});return resultado;}
        function encontrarCoincidencias(str, arregloEntrada) {let arregloEntradaCopia = copiarArreglo(arregloEntrada);const arregloSalida = [];for (let i = 0; i < arregloEntrada.length; i++) {const elementoActual = arregloEntrada[i].toLowerCase();if (elementoActual.includes(str.toLowerCase())) { arregloSalida.push(arregloEntrada[i]); }} return arregloSalida;}
        function ultimaPalabraEscrita(str) { str = str.trim(); const palabras = str.split(/\s+|\.|\{|\}|\(|\)|\t|>|<|;|:|"|'|&|`|[|]|-|\+|\*|\/|\%|\=/); if (palabras.length === 0) { return "" }; return palabras[palabras.length - 1]; }
        function copiarArreglo(arreglo) { return arreglo.slice() }
        function copiarObjeto(objeto) { return Object.assign({}, objeto) }
        function recortarArreglo(index, arreglo) {if (index < 0 || index > arreglo.length) {throw new Error("Index out of bounds");}return arreglo.slice(0, index + 1);}
        function actualizarArreglo(array, nuevoElemento) {array.push(nuevoElemento);array.shift();}
        function lineaActualTextarea() {const cursorPosition = textarea.selectionStart;const texto = textarea.value;let lineas = 0;for (let i = 0; i < cursorPosition; i++) {if (texto[i] === '\n') {lineas++;}}return lineas + 1;}
        function lineaActualRecortada() {const puntoPartida = textarea.selectionStart;let puntoDeInicio = puntoPartida;for (let i = puntoPartida - 1; i >= 0; i--) {if (textarea.value.charCodeAt(i) === 10 || i === 0) {puntoDeInicio = i + 1;break;}};let lineaReal = cambiarCaracteresPorEntidades(textarea.value.substring(puntoDeInicio, puntoPartida));let lineaAjustada = textarea.value.substring(puntoDeInicio, puntoPartida).replace(/\t/g, "XXXXXXXX").replace(/</g, ">").replace(/ /g, "_").replace(/-/g,"+");return { real: lineaReal, ajuste: lineaAjustada }}
        function parrafoActual() {let parrafoReal = cambiarCaracteresPorEntidades(textarea.value.substring(0, textarea.selectionStart));let parrafoAjustado = textarea.value.substring(0, textarea.selectionStart).replace(/\t/g, "XXXXXXXX").replace(/</g, ">").replace(/ /g, "_").replace(/\n/g, "<br>").replace(/-/g,"+");return { real: parrafoReal, ajuste: parrafoAjustado }}function parrafoActual() {let parrafoReal = cambiarCaracteresPorEntidades(textarea.value.substring(0, textarea.selectionStart));let parrafoAjustado = textarea.value.substring(0, textarea.selectionStart).replace(/\t/g, "XXXXXXXX").replace(/</g, ">").replace(/ /g, "_").replace(/\n/g, "<br>").replace(/-/g,"+");return { real: parrafoReal, ajuste: parrafoAjustado }}
        function textoLineaActualTextarea() {const cursorPos = textarea.selectionStart;const textareaValue = textarea.value;let indexInicial = 0;let indexFinal = textareaValue.length;for (let i = cursorPos - 1; i >= 0; i--) {if (textareaValue[i] === '\n') {indexInicial = i + 1;break;}}for (let i = cursorPos; i < textareaValue.length; i++) {if (textareaValue[i] === '\n') {indexFinal = i;break;}}let textoReal = cambiarCaracteresPorEntidades(textareaValue.substring(indexInicial, indexFinal));let textoAjustado = textarea.value.substring(indexInicial, indexFinal).replace(/\t/g, "XXXXXXXX").replace(/</g, ">").replace(/ /g, "_").replace(/-/g,"+");return { real: textoReal, ajuste: textoAjustado };}function textoLineaActualTextarea() {const cursorPos = textarea.selectionStart;const textareaValue = textarea.value;let indexInicial = 0;let indexFinal = textareaValue.length;for (let i = cursorPos - 1; i >= 0; i--) {if (textareaValue[i] === '\n') {indexInicial = i + 1;break;}}for (let i = cursorPos; i < textareaValue.length; i++) {if (textareaValue[i] === '\n') {indexFinal = i;break;}}let textoReal = cambiarCaracteresPorEntidades(textareaValue.substring(indexInicial, indexFinal));let textoAjustado = textarea.value.substring(indexInicial, indexFinal).replace(/\t/g, "XXXXXXXX").replace(/</g, ">").replace(/ /g, "_").replace(/-/g,"+");return { real: textoReal, ajuste: textoAjustado };}
        function copiarAlPortapapeles(texto) {const textareax = document.createElement('textarea');textareax.value = texto;document.body.appendChild(textareax);textareax.select();document.execCommand('copy');document.body.removeChild(textareax);}
        function posicionColumnaFilaCursorTextarea() { const cursorPosition = textarea.selectionStart; const texto = textarea.value; let lineas = 0; for (let i = 0; i < cursorPosition; i++) { if (texto[i] === '\n') { lineas++; } } let indexInicio = cursorPosition; let tabCount = 0; while (indexInicio > 0 && texto[indexInicio - 1] !== '\n') { if (texto[indexInicio - 1] === '\t') { tabCount++; } indexInicio--; } let indexFinal = cursorPosition; while (indexFinal < texto.length && texto[indexFinal] !== '\n') { indexFinal++; } const lineaActual = texto.slice(indexInicio, indexFinal); const posicionX = (cursorPosition - indexInicio) + tabCount * 7; const posicionY = lineas; return { columna: posicionX, fila: posicionY }; }
        function stringSize(str, element) {let divx = document.createElement('div');document.body.appendChild(divx);let fontSize = window.getComputedStyle(element).fontSize;divx.style = `font-size: ${fontSize};width: fit-content;height: fit-content;`;let strEntrada = str;divx.innerHTML = str;const width = divx.offsetWidth;const height = divx.offsetHeight;divx.remove();return { width: width, height: height };}
        function getFontSize(element) { const fontSize = window.getComputedStyle(element).fontSize; return parseInt(fontSize, 10); }//devuelve el valor de la propiedad font-size del CSS del elemento.
        function posicionXYcursor() { let fontSize = parseInt(window.getComputedStyle(textarea).fontSize, 10); fontSize += fontSize * 2 / 16; let lineaActual = lineaActualRecortada().ajuste; let parrafoActualx = parrafoActual().ajuste; let objetox = { x: stringSize(lineaActual, textarea).width, y: stringSize(parrafoActualx, textarea).height }; return objetox }
        function palabrasHtml(strHtml) { var regexVars = /\b(let|const|var)\s+([\w_$]+)\b/g; var regexFuncs = /\bfunction\s+([\w_$]+)\s*\((.*?)\)/g; var regexIds = /\bid\s*=\s*["']([\w_$]+)["']/g; var vars = []; var funcs = []; var ids = []; var match; while ((match = regexVars.exec(strHtml)) !== null) { vars.push(match[2]); } while ((match = regexFuncs.exec(strHtml)) !== null) { funcs.push(match[1] + '(' + match[2] + ')'); } while ((match = regexIds.exec(strHtml)) !== null) { ids.push(match[1]); } return vars.concat(funcs).concat(ids); } function palabrasHtml(strHtml) { var regexVars = /\b(let|const|var)\s+([\w_$]+)\b/g; var regexFuncs = /\bfunction\s+([\w_$]+)\s*\((.*?)\)/g; var regexIds = /\bid\s*=\s*["']([\w_$]+)["']/g; var vars = []; var funcs = []; var ids = []; var match; while ((match = regexVars.exec(strHtml)) !== null) { vars.push(match[2]); } while ((match = regexFuncs.exec(strHtml)) !== null) { funcs.push(match[1] + '(' + match[2] + ')'); } while ((match = regexIds.exec(strHtml)) !== null) { ids.push(match[1]); } return vars.concat(funcs).concat(ids); }
        function cursorFinalLinea(){const selectionStart=textarea.selectionStart;const texto=textarea.value;let finLinea=texto.indexOf('\n',selectionStart);if(finLinea===-1){finLinea=texto.length;}textarea.setSelectionRange(finLinea,finLinea);textarea.focus();}
        function cursorInicioLinea() {let selection = textarea.selectionStart-1;let caracter = textarea.value[selection];if(caracter!="\n"){for(let i = selection;i>0; i--){caracter = textarea.value[i-1];if(caracter == "\n"){textarea.setSelectionRange(i,i);return;}}textarea.setSelectionRange(0,0);}}
        function cursorInicioTextarea() {textarea.selectionStart = textarea.selectionEnd = 0}
        function cursorFinalTextarea() {textarea.selectionStart = textarea.selectionEnd = textarea.value.length}
	function copiarLinea() {copiarAlPortapapeles(textoLineaActualTextarea().real);mf("linea copiada");}
        function seleccionarLinea() {const cursorPos = textarea.selectionStart;const textareaValue = textarea.value;let indexInicial = 0;let indexFinal = textareaValue.length;for (let i = cursorPos - 1; i >= 0; i--) {if (textareaValue[i] === '\n') {indexInicial = i + 1;break}}for (let i = cursorPos; i < textareaValue.length; i++) {if (textareaValue[i] === '\n') {indexFinal = i;break}}textarea.selectionStart = indexInicial; textarea.selectionEnd = indexFinal;}
	function seleccionarParrafo(){let posicionCentral = textarea.selectionStart;let posicionInicial = posicionCentral;let posicionFinal = textarea.value.length;let count = 0;for(let i=posicionCentral;i>1;i--){if(i==0 || i-1==0 || i-2==0){i=0;posicionInicial = i;break}if(textarea.value[i-1]=="\n" && textarea.value[i-2]=="\n"){posicionInicial = i;break}}for(let i=posicionCentral;i<textarea.value.length;i++){if(textarea.value[i]=="\n" && textarea.value[i+1]=="\n"){posicionFinal = i;break}}textarea.selectionStart = posicionInicial;textarea.selectionEnd = posicionFinal}
	function seleccionarTodo(){textarea.selectionStart=0; textarea.selectionEnd=textarea.value.length}

        function deshacer() {
            memoria.textarea.index -= 1;
            if (memoria.textarea.index < 0) { memoria.textarea.index = 0 }
            textarea.value = memoria.textarea.historial[memoria.textarea.index];
        }

        function rehacer() {
            memoria.textarea.index += 1;
            if (memoria.textarea.index > memoria.textarea.historial.length - 1) {
                memoria.textarea.index = memoria.textarea.historial.length - 1
            }
            textarea.value = memoria.textarea.historial[memoria.textarea.index];
        }

        function guardarHistorialTextarea() {
            if (memoria.textarea.index != 19) {
                if (memoria.textarea.historial.length > memoria.textarea.index) {
                    memoria.textarea.historial = recortarArreglo(memoria.textarea.index, memoria.textarea.historial);
                }

                memoria.textarea.historial.push(textarea.value);
                memoria.textarea.index = memoria.textarea.historial.length - 1;
            }
            else {
                actualizarArreglo(memoria.textarea.historial, textarea.value);
            }
        }

        guardarHistorialTextarea();


        

        let input_escala = document.getElementById("input_escala");

        input_escala.addEventListener("change", function () {
            let escala = input_escala.value;
            let p_escala = document.getElementById("p_escala");
            p_escala.innerHTML = escala + "%";

            let fontSize = escala * memoria.textarea.maxFontSize / 100;
            let minFontSize = memoria.textarea.minFontSize;
            let maxFontSize = memoria.textarea.maxFontSize;
            if (fontSize > maxFontSize) { fontSize = maxFontSize }
            textarea.style.fontSize = fontSize + "px";
            enumerador_textarea.elemento.style.fontSize = fontSize + "px";
        })


function corregirTabulacion() {
  const texto = textarea.value; // Obtener texto del textarea
  let lineas = texto.split('\n'); // Separar en líneas
  let tabulacionActual = 0; // Nivel de tabulación actual
  let tabulacionCorregida = ''; // Texto reindentado

  for (let i = 0; i < lineas.length; i++) {
    let linea = lineas[i].trim(); // Eliminar espacios en blanco al inicio y final
    let espacios = ''; // Cadena para almacenar espacios de tabulación

    // Contar llaves y ajustar tabulación
    for (let j = 0; j < linea.length; j++) {
      if (linea[j] === '{') {
        tabulacionActual++;
      } else if (linea[j] === '}') {
        tabulacionActual--;
      }
    }

    // Agregar espacios de tabulación según nivel actual
    for (let k = 0; k < tabulacionActual; k++) {
      espacios += '\t';
    }

    // Agregar línea reindentada
    tabulacionCorregida += espacios + linea + '\n';
  }

  // Mostrar el código reindentado
  textarea.value = tabulacionCorregida;
}


    </script>











</body>

</html>